
require-macros:
   "../src/struct" ->
      struct
   earl-mocha ->
      describe, it, before, after, before-each, after-each
      xdescribe, xit
      assert, asserts
      expect-error

require:
   "../src/index" ->
      identify
      make-struct, read-proxy, write-proxy
      fork, directory, Directory
      patch, changed-relevantly, intersect
      clobber
      ID, FORKID
   "./people" ->
      alice, bob, clara, donald


describe "fork":

   before-each:
      @dir = Directory{}
      @clara = @dir.fork{clara}
      @donald = @dir.fork{donald}

   it "preserves information":
      assert @clara.name == .clara
      assert @clara.age == 20
      assert @clara.mother.name == .alice
      assert @clara.father.name == .bob

   it "is deep":
      assert @clara !== clara
      assert @clara.mother !== clara.mother
      assert @clara.father !== clara.father

   it "maps same ID to same object if duplicate = false (default)":
      assert @donald.mother === @donald.father

   it "creates copies for same ID if duplicate = true":
      @dir = Directory{duplicate = true}
      @clara = @dir.fork{clara}
      @donald = @dir.fork{donald}
      assert @donald.mother !== @donald.father
